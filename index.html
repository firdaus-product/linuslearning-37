<!DOCTYPE html>
<html lang="ms-MY">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Matematik Ceria: Operasi Darab</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    /* --- UI STYLE (MASTER REFERENCE - TEMA HIJAU) --- */
    body { 
        font-family: 'Fredoka', sans-serif; 
        background-color: #f0fdf4; 
        background-image: radial-gradient(#86efac 2px, transparent 2px); 
        background-size: 30px 30px; 
    }
    
    .game-card { 
        background: white; 
        border: 4px solid #475569; 
        box-shadow: 8px 8px 0px #00000020; 
        border-radius: 1.5rem; 
        min-height: 600px; 
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        /* overflow: hidden; <-- DIBUANG supaya nombor tak terpotong jika terkeluar sikit */
    }
    
    /* Buttons */
    .btn-3d { 
        transition: all 0.1s; 
        border-bottom-width: 6px; 
        border-color: rgba(0,0,0,0.2); 
        transform: translateY(0); 
        cursor: pointer; 
        display: inline-block; 
    }
    .btn-3d:active:not(:disabled) { transform: translateY(4px); border-bottom-width: 2px; box-shadow: none; }
    .btn-3d:disabled { opacity: 0.6; cursor: not-allowed; border-bottom-width: 6px; filter: grayscale(100%); }

    /* Animation */
    .shake { animation: shake 0.4s ease-in-out; border-color: #ef4444 !important; background-color: #fee2e2 !important; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px) rotate(-5deg); } 75% { transform: translateX(8px) rotate(5deg); } }

    /* --- STYLE KHUSUS DARAB --- */

    /* Drag & Drop Elements */
    .draggable { cursor: grab; user-select: none; transition: transform 0.2s; }
    .draggable:active { cursor: grabbing; transform: scale(1.1); }
    
    .drop-zone { 
        border: 3px dashed #94a3b8; background-color: #f8fafc; 
        transition: all .3s ease; border-radius: 0.75rem; 
        min-width: 80px; min-height: 80px; 
        display: inline-flex; align-items: center; justify-content: center;
        font-weight: bold; color: #334155;
    }
    .drop-zone.drag-over { border-color: #3b82f6; background-color: #dbeafe; transform: scale(1.05); }
    .drop-zone.filled { border: 3px solid #22c55e; background-color: #dcfce7; color: #15803d; border-style: solid; }

    /* === FIX GARIS NOMBOR === */
    .number-line-wrapper { 
        width: 100%; 
        position: relative; 
        height: 80px; 
        border-bottom: 6px solid #475569; 
        margin-bottom: 40px; /* Ruang extra untuk nombor di bawah */
    }
    .tick { 
        position: absolute; 
        bottom: -6px; 
        width: 4px; 
        height: 20px; 
        background-color: #475569; 
    }
    .tick-label { 
        position: absolute; 
        bottom: -40px; /* Turunkan label nombor */
        left: 50%; 
        transform: translateX(-50%); 
        font-weight: bold; 
        color: #64748b;
        font-size: 1.1rem;
    }
    #frog { 
        position: absolute; 
        bottom: 45px; /* Naikkan katak atas garisan */
        left: 0; 
        margin-left: -25px; /* Center frog visual */
        font-size: 3.5rem; 
        transition: left 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        z-index: 10; 
        filter: drop-shadow(2px 4px 0 rgba(0,0,0,0.2));
    }

    /* Aktiviti 2: Mangkuk */
    .mangkuk { 
        width: 120px; height: 100px; 
        border: 4px solid #b45309; /* Amber-700 */
        background: #fef3c7; /* Amber-100 */
        border-radius: 10px 10px 40px 40px; /* Bentuk mangkuk */
        display: flex; align-items: center; justify-content: center; flex-wrap: wrap; 
        padding: 5px; position: relative;
    }
    .objek-mangkuk { font-size: 1.5rem; line-height: 1; animation: popIn 0.3s ease; }
    @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }

  </style>
</head>
<body class="min-h-screen text-slate-800 pb-10">

  <div class="fixed top-4 left-0 right-0 z-50 px-4 pointer-events-none">
    <div class="max-w-4xl mx-auto bg-green-400 border-4 border-green-600 rounded-full px-6 py-3 shadow-xl flex items-center justify-between pointer-events-auto transform hover:scale-[1.01] transition-transform">
      <div class="flex items-center gap-3">
        <span class="text-3xl animate-bounce">âœ–ï¸</span>
        <span id="info-text" class="text-xl font-bold text-green-900 leading-none mt-1">Operasi Darab (Asas)</span>
      </div>
      <button id="speak-btn" onclick="speakInfo()" class="bg-white hover:bg-green-50 text-green-600 border-2 border-green-200 rounded-full p-2 transition-colors shadow-sm">ğŸ”Š</button>
    </div>
  </div>
  <div class="h-24"></div>

  <div class="max-w-6xl mx-auto p-4">
    
    <div class="game-card p-8 mb-8">
        <div id="activity-content" class="w-full relative z-10 flex flex-col items-center justify-center h-full">
            <div class="py-10 text-center">
                <div class="text-8xl mb-6 animate-pulse">âœ–ï¸</div>
                <h2 class="text-5xl font-bold text-emerald-600 mb-4">Konsep Darab</h2>
                <p class="text-2xl text-slate-500 mb-8 font-semibold">Teroka tambah berulang dan kumpulan.</p>
                <div class="text-4xl animate-bounce">ğŸ‘‡</div>
            </div>
        </div>
    </div>

    <div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-2 border-white">
      <h3 class="text-2xl font-bold text-slate-700 mb-4 text-center">ğŸ® Pilih Aktiviti</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8">
        <button onclick="loadActivity(1)" class="btn-3d bg-blue-500 text-white font-bold py-4 px-2 rounded-xl text-lg">ğŸ¸ Lompat (Nombor)</button>
        <button onclick="loadActivity(2)" class="btn-3d bg-green-500 text-white font-bold py-4 px-2 rounded-xl text-lg">ğŸ¥­ Kumpulan (Objek)</button>
        <button onclick="loadActivity(3)" class="btn-3d bg-purple-500 text-white font-bold py-4 px-2 rounded-xl text-lg">ğŸŸ Cerita (Ayat)</button>
        <button onclick="loadActivity(4)" class="btn-3d bg-orange-500 text-white font-bold py-4 px-2 rounded-xl text-lg">ğŸ–¼ï¸ Padanan (Visual)</button>
        <button onclick="loadActivity(5)" class="btn-3d bg-rose-500 text-white font-bold py-4 px-2 rounded-xl text-lg">ğŸš— Pekan (Teroka)</button>
      </div>

      <div class="flex justify-center gap-4 border-t-2 border-slate-100 pt-6">
        <button onclick="clearActivity()" class="btn-3d bg-slate-400 text-white font-bold py-2 px-6 rounded-full text-lg">ğŸ  Menu</button>
        <button onclick="nextActivity()" class="btn-3d bg-indigo-500 text-white font-bold py-2 px-8 rounded-full text-xl">Seterusnya â¡ï¸</button>
      </div>
    </div>
  </div>

  <script>
    /* --- STANDARD HELPERS --- */
    let currentActivity = 0;
    let ttsEnabled = false;
    let currentInfo = "Pilih aktiviti untuk mula belajar darab!";
    let draggedElement = null;
    let lompatState = { saiz: 2, kiraan: 0, jumlah: 0, maxTicks: 10 };

    function triggerWin() { confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } }); }

    function speak(text) { 
        if (!ttsEnabled || !('speechSynthesis' in window)) return; 
        window.speechSynthesis.cancel(); 
        const u = new SpeechSynthesisUtterance(text); u.lang = 'ms-MY'; u.rate = 0.95; u.pitch = 1.05; 
        const ms = window.speechSynthesis.getVoices().find(v => v.lang === 'ms-MY' || v.lang?.startsWith('ms')); 
        if (ms) u.voice = ms; 
        window.speechSynthesis.speak(u); 
    }
    
    function setInfo(text) { 
        currentInfo = text; const infoEl = document.getElementById('info-text'); 
        infoEl.style.opacity = 0; setTimeout(() => { infoEl.textContent = text; infoEl.style.opacity = 1; }, 200); 
    }
    
    function speakInfo() { 
        if (!ttsEnabled) { ttsEnabled = true; document.getElementById('speak-btn').classList.add('bg-green-100', 'text-green-600'); } 
        speak(currentInfo); 
    }

    /* --- DRAG & DROP LOGIC --- */
    window.dragStart = function(e) { draggedElement = e.target; e.target.classList.add('opacity-50'); }
    window.dragEnd = function(e) { e.target.classList.remove('opacity-50'); document.querySelectorAll('.drop-zone').forEach(z=>z.classList.remove('drag-over')); }
    window.allowDrop = function(e) { e.preventDefault(); if (e.currentTarget.classList.contains('drop-zone')) e.currentTarget.classList.add('drag-over'); }
    window.dragLeave = function(e) { if (e.currentTarget.classList.contains('drop-zone')) e.currentTarget.classList.remove('drag-over'); }

    /* --- ROUTER --- */
    function loadActivity(n) {
      currentActivity = n;
      const content = document.getElementById('activity-content');
      content.style.opacity = 0;
      setTimeout(() => {
          if (n === 1) loadLompatActivity(content);
          if (n === 2) loadKumpulanActivity(content);
          if (n === 3) loadCeritaActivity(content);
          if (n === 4) loadPadanAyatActivity(content);
          if (n === 5) loadPekanDarabActivity(content);
          content.style.opacity = 1;
      }, 200);
    }

    function clearActivity() {
        currentActivity = 0;
        document.getElementById('activity-content').innerHTML = `<div class="py-10 text-center"><div class="text-8xl mb-6 animate-pulse">âœ–ï¸</div><h2 class="text-5xl font-bold text-emerald-600 mb-4">Konsep Darab</h2><p class="text-2xl text-slate-500 mb-8 font-semibold">Sila pilih aktiviti di bawah.</p></div>`;
        setInfo("Pilih aktiviti untuk mula belajar!");
    }
    function nextActivity() { let next = currentActivity + 1; if (next > 5) next = 1; loadActivity(next); }


    /* =========================================
       LOGIK AKTIVITI 
       ========================================= */

    /* 1. Lompat-Lompat (Garis Nombor) */
    function loadLompatActivity(content) {
      setInfo("Pilih saiz lompatan, kemudian tekan 'Lompat!'.");
      content.innerHTML = `
        <div class="w-full max-w-3xl text-center">
            <h3 class="text-3xl font-bold text-blue-500 mb-4">ğŸ¸ Mesin Lompat Katak</h3>
            
            <div class="flex justify-center gap-4 mb-8">
                <button class="btn-3d bg-blue-100 text-blue-800 font-bold py-2 px-6 rounded-xl" onclick="setLompat(2, this)">2 (Dua-dua)</button>
                <button class="btn-3d bg-white text-slate-600 font-bold py-2 px-6 rounded-xl" onclick="setLompat(5, this)">5 (Lima-lima)</button>
                <button class="btn-3d bg-white text-slate-600 font-bold py-2 px-6 rounded-xl" onclick="setLompat(4, this)">4 (Empat-empat)</button>
            </div>
            
            <div class="bg-slate-100 border-4 border-slate-300 rounded-3xl p-6 mb-6 relative h-64 flex items-end justify-center shadow-inner">
                <div id="number-line-container" class="number-line-wrapper">
                    </div>
                <div id="frog">ğŸ¸</div>
            </div>

            <div class="flex justify-center gap-4 mb-8">
                <button onclick="doLompat()" class="btn-3d bg-blue-500 text-white font-bold py-3 px-10 rounded-xl text-xl">Lompat! ğŸš€</button>
                <button onclick="resetLompat()" class="btn-3d bg-slate-400 text-white font-bold py-3 px-6 rounded-xl text-xl">Reset â†º</button>
            </div>

            <div class="grid grid-cols-2 gap-4 text-left">
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                    <div class="text-sm font-bold text-blue-400 uppercase">Ayat Tambah</div>
                    <div id="ayat-tambah" class="text-xl font-bold text-blue-800">...</div>
                </div>
                <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-200">
                    <div class="text-sm font-bold text-indigo-400 uppercase">Ayat Darab</div>
                    <div id="ayat-darab" class="text-xl font-bold text-indigo-800">...</div>
                </div>
            </div>
        </div>
      `;
      resetLompat(2); 
      const btn = document.querySelector('button[onclick*="setLompat(2"]');
      if(btn) { btn.classList.remove('bg-white','text-slate-600'); btn.classList.add('bg-blue-100','text-blue-800'); }
    }

    function setLompat(saiz, btn) {
        document.querySelectorAll('button[onclick^="setLompat"]').forEach(b => {
            b.classList.remove('bg-blue-100','text-blue-800');
            b.classList.add('bg-white','text-slate-600');
        });
        btn.classList.remove('bg-white','text-slate-600');
        btn.classList.add('bg-blue-100','text-blue-800');
        resetLompat(saiz);
    }

    function resetLompat(saiz = lompatState.saiz) {
        lompatState = { saiz, kiraan: 0, jumlah: 0, maxTicks: 10 };
        document.getElementById('ayat-tambah').textContent = "...";
        document.getElementById('ayat-darab').textContent = "...";
        
        const line = document.getElementById('number-line-container');
        line.innerHTML = '';
        for (let i = 0; i <= lompatState.maxTicks; i++) {
            const leftPos = (i / lompatState.maxTicks) * 100;
            line.innerHTML += `<div class="tick" style="left: ${leftPos}%"><span class="tick-label">${i * saiz}</span></div>`;
        }
        document.getElementById('frog').style.left = `0%`;
        setInfo(`Katak sedia melompat ${saiz}-${saiz}.`);
    }

    function doLompat() {
        if (lompatState.kiraan >= lompatState.maxTicks) {
            setInfo("Sudah sampai hujung! Tekan 'Reset'.");
            return;
        }
        
        lompatState.kiraan++;
        lompatState.jumlah += lompatState.saiz;
        
        let tambahStr = Array(lompatState.kiraan).fill(lompatState.saiz).join(' + ');
        document.getElementById('ayat-tambah').textContent = `${tambahStr} = ${lompatState.jumlah}`;
        document.getElementById('ayat-darab').textContent = `${lompatState.kiraan} Ã— ${lompatState.saiz} = ${lompatState.jumlah}`;
        
        const leftPos = (lompatState.kiraan / lompatState.maxTicks) * 100;
        document.getElementById('frog').style.left = `${leftPos}%`;
        
        const msg = `${lompatState.kiraan} darab ${lompatState.saiz} sama dengan ${lompatState.jumlah}.`;
        setInfo(msg); speak(msg);
        
        if(lompatState.kiraan === 3 || lompatState.kiraan === 5 || lompatState.kiraan === 10) triggerWin();
    }

    /* 2. Susun Kumpulan */
    function loadKumpulanActivity(content) {
        setInfo("Seret 2 biji manggis ke dalam SETIAP mangkuk.");
        content.innerHTML = `
            <div class="text-center w-full max-w-4xl">
                <h3 class="text-3xl font-bold text-green-600 mb-6">ğŸ¥­ Susun Kumpulan</h3>
                
                <div class="bg-slate-100 p-6 rounded-2xl border-2 border-slate-200 mb-8">
                    <div class="text-slate-500 font-bold mb-4 uppercase tracking-wider">Bakul Manggis</div>
                    <div id="objek-bank" class="flex flex-wrap justify-center gap-4">
                        ${Array(12).fill(0).map(() => `
                            <div class="btn-3d bg-white border-slate-200 rounded-full w-12 h-12 flex items-center justify-center text-2xl cursor-grab draggable" 
                                 draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)">ğŸ¥­</div>
                        `).join('')}
                    </div>
                </div>

                <div class="flex flex-wrap items-end justify-center gap-8 mb-8">
                    ${[1,2,3].map(i => `
                        <div class="text-center">
                            <div class="mangkuk drop-zone transition-colors" 
                                 ondrop="dropOnMangkuk(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" 
                                 data-group="${i}" data-limit="2" data-count="0"></div>
                            <div class="font-bold text-amber-800 mt-2">Mangkuk ${i}</div>
                        </div>
                    `).join('')}
                </div>

                <div id="result-kumpulan" class="text-3xl font-bold text-green-600 opacity-0 transition-opacity">
                    Hebat! 3 Ã— 2 = 6
                </div>
            </div>
        `;
    }

    function dropOnMangkuk(e) {
        e.preventDefault(); e.currentTarget.classList.remove('drag-over'); if (!draggedElement) return;
        
        let count = parseInt(e.currentTarget.dataset.count);
        const limit = parseInt(e.currentTarget.dataset.limit);
        
        if (count < limit) {
            count++;
            e.currentTarget.dataset.count = count;
            draggedElement.remove(); draggedElement = null;
            
            const newObjek = document.createElement('span');
            newObjek.className = 'objek-mangkuk';
            newObjek.textContent = 'ğŸ¥­';
            e.currentTarget.appendChild(newObjek);
            speak("Masuk.");
            
            if (count === limit) {
                e.currentTarget.classList.add('border-green-500', 'bg-green-100');
                e.currentTarget.classList.remove('drop-zone');
            }
            
            const mangkukPenuh = document.querySelectorAll('.mangkuk[data-count="2"]').length;
            if (mangkukPenuh === 3) {
                const msg = "Syabas! 3 kumpulan, 2 setiap satu, jumlah 6.";
                setInfo(msg); speak(msg); triggerWin();
                document.getElementById('result-kumpulan').classList.remove('opacity-0');
            }
        } else {
            e.currentTarget.classList.add('shake'); setTimeout(() => e.currentTarget.classList.remove('shake'), 500);
            speak("Mangkuk dah penuh.");
        }
    }

    /* 3. Penterjemah Cerita */
    function loadCeritaActivity(content) {
        setInfo("Lengkapkan ayat matematik berdasarkan cerita.");
        content.innerHTML = `
            <div class="text-center w-full max-w-4xl">
                <h3 class="text-3xl font-bold text-purple-500 mb-6">ğŸŸ Penterjemah Cerita</h3>
                
                <div class="bg-blue-50 border-4 border-blue-200 rounded-3xl p-8 mb-8 flex flex-col md:flex-row items-center gap-6 shadow-sm">
                    <div class="text-8xl">ğŸ </div>
                    <div class="text-left">
                        <p class="text-2xl text-blue-900 leading-relaxed">
                            Cikgu ada <strong class="text-rose-500">4 buah akuarium</strong>.<br>
                            Setiap akuarium ada <strong class="text-rose-500">5 ekor ikan</strong>.
                        </p>
                    </div>
                </div>

                <div class="flex justify-center gap-6 mb-10">
                    <div class="btn-3d bg-purple-100 border-purple-300 text-purple-800 rounded-xl p-4 text-4xl font-bold draggable" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-number="4">4</div>
                    <div class="btn-3d bg-purple-100 border-purple-300 text-purple-800 rounded-xl p-4 text-4xl font-bold draggable" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-number="5">5</div>
                </div>

                <div class="flex flex-wrap items-center justify-center gap-4 text-4xl font-bold text-slate-400">
                    <div class="flex flex-col items-center">
                        <div class="drop-zone w-24 h-24 rounded-xl text-4xl text-slate-700" ondrop="dropOnCerita(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-correct="4">?</div>
                        <span class="text-sm mt-2 font-normal">Kumpulan</span>
                    </div>
                    <span>Ã—</span>
                    <div class="flex flex-col items-center">
                        <div class="drop-zone w-24 h-24 rounded-xl text-4xl text-slate-700" ondrop="dropOnCerita(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-correct="5">?</div>
                        <span class="text-sm mt-2 font-normal">Ahli</span>
                    </div>
                    <span>=</span>
                    <div class="text-purple-600" id="result-cerita">20</div>
                </div>
            </div>
        `;
    }

    function dropOnCerita(e) {
        e.preventDefault(); e.currentTarget.classList.remove('drag-over'); if (!draggedElement) return;
        const val = draggedElement.dataset.number;
        const correct = e.currentTarget.dataset.correct;
        
        if (val === correct) {
            e.currentTarget.textContent = val;
            e.currentTarget.classList.add('filled');
            e.currentTarget.classList.remove('drop-zone');
            draggedElement.remove(); draggedElement = null;
            speak("Betul.");
            
            if (document.querySelectorAll('#activity-content .drop-zone').length === 0) {
                triggerWin();
                const msg = "Lengkap! 4 darab 5 sama dengan 20.";
                setInfo(msg); speak(msg);
                document.getElementById('result-cerita').classList.add('animate-bounce', 'text-6xl');
            }
        } else {
            e.currentTarget.classList.add('shake'); setTimeout(() => e.currentTarget.classList.remove('shake'), 500);
            speak("Salah tempat.");
        }
    }

    /* 4. Padankan Ayat */
    function loadPadanAyatActivity(content) {
        setInfo("Seret ayat matematik ke kotak yang betul.");
        content.innerHTML = `
            <div class="text-center w-full max-w-4xl">
                <h3 class="text-3xl font-bold text-orange-500 mb-6">ğŸ–¼ï¸ Padankan Ayat</h3>
                
                <div class="bg-white border-4 border-slate-100 p-6 rounded-3xl mb-8">
                    <div class="flex justify-center gap-4 text-5xl mb-2">
                        <span>ğŸª</span><span>ğŸª</span><span>ğŸª</span><span>ğŸª</span>
                    </div>
                    <div class="flex justify-center gap-4 text-5xl mb-2">
                        <span>ğŸª</span><span>ğŸª</span><span>ğŸª</span><span>ğŸª</span>
                    </div>
                    <div class="flex justify-center gap-4 text-5xl">
                        <span>ğŸª</span><span>ğŸª</span><span>ğŸª</span><span>ğŸª</span>
                    </div>
                    <p class="text-slate-400 mt-4 font-bold">3 Baris (Kumpulan), 4 Biskut (Ahli)</p>
                </div>

                <div class="flex justify-center flex-wrap gap-4 mb-10">
                    <div class="btn-3d bg-orange-100 text-orange-800 p-4 rounded-xl text-xl font-bold draggable" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-ayat="darab">3 Ã— 4</div>
                    <div class="btn-3d bg-blue-100 text-blue-800 p-4 rounded-xl text-xl font-bold draggable" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-ayat="tambah">4 + 4 + 4</div>
                    <div class="btn-3d bg-rose-100 text-rose-800 p-4 rounded-xl text-xl font-bold draggable" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-ayat="salah">3 + 4</div>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-blue-50 p-6 rounded-2xl border-2 border-blue-100">
                        <div class="text-blue-400 font-bold uppercase mb-2">Ayat Tambah</div>
                        <div class="drop-zone w-full h-20 text-2xl rounded-xl" ondrop="dropOnAyat(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-correct="tambah">...</div>
                    </div>
                    <div class="bg-orange-50 p-6 rounded-2xl border-2 border-orange-100">
                        <div class="text-orange-400 font-bold uppercase mb-2">Ayat Darab</div>
                        <div class="drop-zone w-full h-20 text-2xl rounded-xl" ondrop="dropOnAyat(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-correct="darab">...</div>
                    </div>
                </div>
            </div>
        `;
    }

    function dropOnAyat(e) {
        e.preventDefault(); e.currentTarget.classList.remove('drag-over'); if (!draggedElement) return;
        const val = draggedElement.dataset.ayat;
        const correct = e.currentTarget.dataset.correct;

        if (val === correct) {
            e.currentTarget.innerHTML = draggedElement.innerHTML;
            e.currentTarget.classList.add('filled');
            e.currentTarget.classList.remove('drop-zone');
            draggedElement.remove(); draggedElement = null;
            speak("Tepat sekali.");
            
            if (document.querySelectorAll('#activity-content .drop-zone').length === 0) {
                triggerWin(); setInfo("Syabas! Anda faham hubungan tambah dan darab.");
            }
        } else {
            e.currentTarget.classList.add('shake'); setTimeout(() => e.currentTarget.classList.remove('shake'), 500);
            speak("Cuba lagi.");
        }
    }

    /* 5. Pekan Darab (Eksplorasi) */
    function loadPekanDarabActivity(content) {
        setInfo("Gerakkan slider untuk ubah kumpulan dan objek.");
        content.innerHTML = `
            <div class="w-full max-w-4xl">
                <h3 class="text-3xl font-bold text-rose-500 mb-6 text-center">ğŸš— Pekan Darab</h3>
                
                <div class="grid md:grid-cols-2 gap-8 items-start">
                    <div class="bg-slate-50 p-6 rounded-2xl border-2 border-slate-200">
                        <div class="mb-8">
                            <label class="flex justify-between font-bold text-slate-600 mb-2">
                                <span>Bilangan Kumpulan</span>
                                <span id="val-kumpulan" class="text-rose-600 text-2xl">3</span>
                            </label>
                            <input type="range" id="slider-kumpulan" min="1" max="5" value="3" class="w-full accent-rose-500 h-4 rounded-lg cursor-pointer" oninput="updatePekan()">
                        </div>
                        <div>
                            <label class="flex justify-between font-bold text-slate-600 mb-2">
                                <span>Bilangan Kereta</span>
                                <span id="val-objek" class="text-rose-600 text-2xl">4</span>
                            </label>
                            <input type="range" id="slider-objek" min="1" max="6" value="4" class="w-full accent-rose-500 h-4 rounded-lg cursor-pointer" oninput="updatePekan()">
                        </div>
                    </div>

                    <div class="bg-rose-50 p-6 rounded-2xl border-2 border-rose-100 min-h-[300px] flex flex-col justify-between">
                        <div id="pekan-visual" class="flex flex-col gap-4 mb-4"></div>
                        <div class="bg-white p-4 rounded-xl border border-rose-200 text-center">
                            <div id="pekan-tambah" class="text-slate-500 font-mono text-sm mb-1">...</div>
                            <div id="pekan-darab" class="text-3xl font-bold text-rose-600">...</div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        updatePekan();
    }

    function updatePekan() {
        const k = parseInt(document.getElementById('slider-kumpulan').value);
        const o = parseInt(document.getElementById('slider-objek').value);
        
        document.getElementById('val-kumpulan').textContent = k;
        document.getElementById('val-objek').textContent = o;
        
        const visualEl = document.getElementById('pekan-visual');
        visualEl.innerHTML = '';
        
        for(let i=0; i<k; i++) {
            // Create row container
            let rowHtml = `<div class="flex justify-center gap-2 bg-rose-100/50 p-2 rounded-lg border border-rose-200 border-dashed">`;
            for(let j=0; j<o; j++) {
                rowHtml += `<span class="text-2xl">ğŸš—</span>`;
            }
            rowHtml += `</div>`;
            visualEl.innerHTML += rowHtml;
        }

        const total = k * o;
        const tambahStr = Array(k).fill(o).join(' + ');
        document.getElementById('pekan-tambah').textContent = `${tambahStr} = ${total}`;
        document.getElementById('pekan-darab').textContent = `${k} Ã— ${o} = ${total}`;
    }

  </script>
</body>
</html>
